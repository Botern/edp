<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <title>自定义 Processor | EDP</title>
    <link rel="stylesheet" href="/edp/css/page.css" type="text/css">
    <link rel="stylesheet" href="/edp/css/font-awesome.css" type="text/css">
    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?9773c6955c8a4722f2938db42b6d6c04";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
</head>
<body>
<header id="header">
    <a class='logo' href="/edp/">
        <img src="/edp/css/images/logo.png" width="120" alt="logo">
    </a>

    <nav class="menu">
        <a href="/edp/doc/initialization/install/"><i class="fa fa-book"></i> Docs</a>
        <a href="https://github.com/ecomfe/edp" target="_blank"><i class="fa fa-github"></i> GitHub</a>
    </nav>
</header>

<div class="wrap">
    <aside id="sidebar">
<div class="tree">
    <h1>Category</h1>
    <ul class="category">
        <li><b class="cat-title">安装与使用</b>
            <ul>
                <li><a href="/edp/doc/initialization/install/">安装</a>
                    <ul>
                        <li><a href="/edp/doc/initialization/install/#npm install">npm install</a></li>
                        <li><a href="/edp/doc/initialization/install/#使用cnpm安装">使用cnpm安装</a></li>
                        <li><a href="/edp/doc/initialization/install/#使用内网npm镜像安装">使用内网npm镜像安装</a></li>
                    </ul>
                </li>
                <li><a href="/edp/doc/initialization/use-cli/">通过命令行使用</a></li>
                <li><a href="/edp/doc/initialization/use-web/">通过web使用</a></li>
                <li><a href="/edp/doc/initialization/update/">升级</a></li>
            </ul>
        </li>
        <li><b class="cat-title">包管理</b>
            <ul>
                <li><a href="/edp/doc/package-management/reasonof-pack-mngm/">为什么要进行包管理</a></li>
                <li><a href="/edp/doc/package-management/find-curr-pack/">查找当前存在的包</a></li>
                <li><a href="/edp/doc/package-management/instl-and-use/">导入并使用包</a>
                    <ul>
                        <li><a href="/edp/doc/package-management/instl-and-use/#导入包的最新版">导入包的最新版</a></li>
                        <li><a href="/edp/doc/package-management/instl-and-use/#导入指定版本的包">导入指定版本的包</a></li>
                    </ul>
                </li>
                <li><a href="/edp/doc/package-management/update-pack/">升级已导入的包</a>
                    <ul>
                        <li><a href="/edp/doc/package-management/update-pack/#升级指定包">升级指定包</a></li>
                        <li><a href="/edp/doc/package-management/update-pack/#升级所有包">升级所有包</a></li>
                    </ul>
                </li>
            </ul>
        </li>
        <li><b class="cat-title">项目管理</b>
            <ul>
                <li><a href="/edp/doc/project-management/init-proj/">初始化项目</a></li>
                <li><a href="/edp/doc/project-management/advantage/">使用edp项目的好处</a></li>
            </ul>
        </li>
        <li><b class="cat-title">项目构建</b>
            <ul>
                <li><a href="/edp/doc/build/build/">构建一个项目</a>
                    <ul>
                        <li><a href="/edp/doc/build/build/#指定输出目录">指定输出目录</a></li>
                        <li><a href="/edp/doc/build/build/#强制覆盖">强制覆盖</a></li>
                        <li><a href="/edp/doc/build/build/#指定构建配置文件">指定构建配置文件</a></li>
                    </ul>
                </li>
                <li><a href="/edp/doc/build/build-proc/">构建过程</a></li>
                <li><a href="/edp/doc/build/builtin-processor/">内置 Processor</a>
                    <ul>
                        <li><a href="/edp/doc/build/builtin-processor/#公共属性">公共属性</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#LessCompiler">LessCompiler</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#StylusCompiler">StylusCompiler</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#CssCompressor">CssCompressor</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#JsCompressor">JsCompressor</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#ModuleCompiler">ModuleCompiler</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#PathMapper">PathMapper</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#TplMerge">TplMerge</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#AddCopyright">AddCopyright</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#VariableSubstitution">VariableSubstitution</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#MD5Renamer">MD5Renamer</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#OutputCleaner">OutputCleaner</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#BabelProcessor">BabelProcessor</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#BcsUploader">BcsUploader</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#CssSpriter">CssSpriter</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#HtmlMinifier">HtmlMinifier</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#Html2JsCompiler">Html2JsCompiler</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#ReplaceDebug">ReplaceDebug</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#StringReplace">StringReplace</a></li>
                        
                    </ul>
                </li>
                <li><a href="/edp/doc/build/cust-processor/">自定义 Processor</a>
                    <ul>
                        <li><a href="/edp/doc/build/cust-processor/#Processor的运行过程">Processor的运行过程</a></li>
                        <li><a href="/edp/doc/build/cust-processor/#通过Object自定义processor">通过Object自定义processor</a></li>
                        <li><a href="/edp/doc/build/cust-processor/#从AbstractProcessor继承自定义processor">从AbstractProcessor继承自定义processor</a></li>
                    </ul>
                </li>
                <li><a href="/edp/doc/build/cust-build/">通过配置进行自定义构建</a>
                    <ul>
                        <li><a href="/edp/doc/build/cust-build/#input">input</a></li>
                        <li><a href="/edp/doc/build/cust-build/#output">output</a></li>
                        <li><a href="/edp/doc/build/cust-build/#exclude">exclude</a></li>
                        <li><a href="/edp/doc/build/cust-build/#fileEncodings">fileEncodings</a></li>
                        <li><a href="/edp/doc/build/cust-build/#getProcessors">getProcessors</a></li>
                        <li><a href="/edp/doc/build/cust-build/#injectProcessor">injectProcessor</a></li>
                    </ul>
                </li>
            </ul>
        </li>
        <li><b class="cat-title">前端代码静态检测</b>
            <ul>
                <li><a href="/edp/doc/lint/code-check/">代码检测</a></li>
                <li><a href="/edp/doc/lint/js-check/">Javascript代码检测</a>
                    <ul>
                        <li><a href="/edp/doc/lint/js-check/#自定义配置">自定义jshint配置</a></li>
                        <li><a href="/edp/doc/lint/js-check/#排除检测文件">排除检测文件</a></li>
                    </ul>
                </li>
                <li><a href="/edp/doc/lint/css-check/">CSS代码检测</a>
                    <ul>
                        <li><a href="/edp/doc/lint/css-check/#自定义配置">自定义csslint配置</a></li>
                        <li><a href="/edp/doc/lint/css-check/#排除检测文件">排除检测文件</a></li>
                    </ul>
                </li>
                <li><a href="/edp/doc/lint/html-check/">HTML代码检测</a>
                    <ul>
                        <li><a href="/edp/doc/lint/html-check/#排除检测文件">排除检测文件</a></li>
                    </ul>
                </li>
            </ul>
        </li>
        <li><b class="cat-title">使用WebServer进行调试</b>
            <ul>
                <li><a href="/edp/doc/webserver/start-server/">启动WebServer</a>
                    <ul>
                        <li><a href="/edp/doc/webserver/start-server/#指定监听端口">指定监听端口</a></li>
                        <li><a href="/edp/doc/webserver/start-server/#指定WebServer配置文件">指定WebServer配置文件</a></li>
                    </ul>
                </li>
                <li><a href="/edp/doc/webserver/conf-server/">配置WebServer</a>
                    <ul>
                        <li><a href="/edp/doc/webserver/conf-server/#port">port</a></li>
                        <li><a href="/edp/doc/webserver/conf-server/#directoryIndexes">directoryIndexes</a></li>
                        <li><a href="/edp/doc/webserver/conf-server/#documentRoot">documentRoot</a></li>
                        <li><a href="/edp/doc/webserver/conf-server/#injectResource">injectResource</a></li>
                        <li><a href="/edp/doc/webserver/conf-server/#getLocations">getLocations</a></li>
                    </ul>
                </li>
                <li><a href="/edp/doc/webserver/resource-func/">资源处理函数</a></li>
                <li><a href="/edp/doc/webserver/inner-resour-func/">内置资源处理函数</a>
                    <ul>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#file">file</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#content">content</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#header">header</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#json">json</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#jsonp">jsonp</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#dumpRequest">dumpRequest</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#redirect">redirect</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#less">less</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#autoless">autoless</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#stylus">stylus</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#autostylus">autostylus</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#autocss">autocss</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#coffee">coffee</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#autocoffee">autocoffee</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#php">php</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#proxy">proxy</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#proxyNoneExists">proxyNoneExists</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#html2js">html2js</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#livereload">livereload</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#listDirectory">listDirectory</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#addRequestHeader">addRequestHeader</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#write">write</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#home">home</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#delay">delay</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#empty">empty</a></li>
                    </ul>
                </li>
                <li><a href="/edp/doc/webserver/cust-resour-func/">自定义资源处理函数</a></li>
            </ul>
        </li>
        <li><b class="cat-title">扩展自己的EDP命令</b>
            <ul>
                <li><a href="/edp/doc/command-extension/builtin-comd/">Builtin Commands</a></li>
                <li><a href="/edp/doc/command-extension/comd-resol/">Command Resolve</a>
                    <ul>
                        <li><a href="/edp/doc/command-extension/comd-resol/#Default Command">Default Command</a></li>
                        <li><a href="/edp/doc/command-extension/comd-resol/#Sub Command">Sub Command</a></li>
                        <li><a href="/edp/doc/command-extension/comd-resol/#Arguments and Options">Arguments and Options</a></li>
                    </ul>
                </li>
                <li><a href="/edp/doc/command-extension/user-comd/">User Commands</a></li>
                <li><a href="/edp/doc/command-extension/comd-help/">Command Help</a></li>
            </ul>
        </li>
        <li><b class="cat-title">诊断工具</b>
            <ul>
                <li><a href="/edp/doc/doctor/doctor/">Doctor</a></li>
            </ul>
        </li>
    </ul>
</div>
</aside>
<script src="http://libs.baidu.com/jquery/1.9.1/jquery.min.js"></script>
<script>
/*
    $(function() {
        $(".category a").on("click", function() {
            var $this = $(this);
            var $li = $this.parents("li:eq(0)");
            var $ul = $li.children("ul:eq(0)");

            if($($ul)[0].className){
                $ul.removeClass();
                $this.removeClass('open');
            }
            else{
                $ul.addClass("show");
                $this.addClass('open');
            }
            var str = "";
            $(".category.show").each(function(){
                str += $("ul").index($(this)[0]) + " ";
            });
            localStorage.setItem("show_index", str);
        });

        var str = localStorage.getItem("show_index");
        str = str.substring(0, str.length - 1);
        var arr = str.split(" ");
        for(var i = 0; i < arr.length; i++) {
            $("ul:eq(" + arr[i] + ")").addClass("show");
        }

        $(".category.show").siblings("a").addClass('open');

    });
*/

//    var aa = document.getElementsByTagName('a');
////    alert(lis.length);
////    e.stopPropagation();
//
//    for(var i = 0; i < aa.length; i++){
//        if(document.all){
//            aa[i].attachEvent('onclick', toggleList);
//        }
//        else{
//            aa[i].addEventListener('click', toggleList, false);
//        }
//    }
//    function toggleList(e){
//        var e = e || window.event;
//        var childList = e.srcElement.parentElement.getElementsByTagName('ul');
////        alert(childList.length);
//        if(childList.length > 0) {
////            alert(childList[0].className);
//            if(childList[0].className) {
//                childList[0].removeAttribute('class');
//            }
//            else {
//                childList[0].setAttribute('class', 'show');
//            }
//        }
//
////        alert(typeof(e.srcElement.parentElement) );
//    }
</script>
    <section id="main">
        <article>
    <h1 class="article-title">自定义 Processor</h1>

    <p>有时，内置的Processor没法满足我们的需求。EDP BUILD的<code>配置文件</code>是一个<code>node module</code>。我们可以很灵活的在<code>配置文件</code>中自定义自己的Processor。在下面的章节里，我们简单介绍了<code>Processor的运行过程</code>，然后提供了<code>通过Object自定义processor</code>和<code>从AbstractProcessor继承自定义processor</code>的例子</p>
<h2 id="Processor的运行过程">Processor的运行过程</h2><p><a href="Build#%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B">构建过程</a>中，构建主模块通过<code>Processor</code>的实例方法<code>start(processContext, callback)</code>，与<code>Processor</code>发生交互。<code>Processor</code>执行完成后，调用由构建主模块传入的<code>callback</code>，通知主模块当前<code>Processor</code>处理已经完成。</p>
<p><code>Processor</code>的<code>start</code>方法做三件事情：</p>
<ol>
<li>调用实例方法<code>beforeAll(processContext)</code>。该方法默认实现为<code>根据files属性选取当前processor要处理的文件集</code></li>
<li>根据选取的文件集，挨个调用实例方法<code>process(file, processContext, callback)</code></li>
<li>调用实例方法<code>afterAll(processContext)</code>。该方法默认不做任何事情，需要后续处理的processor可以实现该方法</li>
</ol>
<p>大多数情况下，自定义自己的Processor都是为了对文件内容做一些自己的处理，这时候只需要重写process方法。我们来看看<code>process</code>方法的参数：</p>
<h3 id="file">file</h3><p><code>FileInfo</code>。EDP Build在读入文件时，会把文件包装成<code>FileInfo</code>对象，你可以通过<code>setData</code>方法更改数据内容。最后，EDP Build会根据这个<code>FileInfo</code>对象的状态进行输出。</p>
<p>该对象包含以下属性：</p>
<ul>
<li>data - 文件数据，文本文件时data为<code>string</code>，二进制文件时data为<code>Buffer</code></li>
<li>extname - 文件扩展名</li>
<li>path - 文件路径，相对于构建目录</li>
<li>fullPath - 文件完整路径</li>
<li>fileEncoding - 文件的文本编码类型</li>
<li>outputPath - 输出路径，修改此项可以更改文件输出目标</li>
</ul>
<h3 id="processContext">processContext</h3><p><code>ProcessContext</code>。构建处理运行时，该对象包含一些运行的基本环境信息。</p>
<ul>
<li>baseDir - 构建基础目录</li>
<li>exclude - 构建排除文件列表</li>
<li>outputDir - 构建输出目录</li>
<li>fileEncodings - 文件编码表</li>
</ul>
<h3 id="callback">callback</h3><p><code>function</code>。当前文件处理完成的回调函数。</p>
<p>由于处理过程可能是异步的（比如less只提供了异步编译接口），所以，处理完成后需要手工调用<code>callback</code>，告诉EDP<code>当前文件的处理已经完成</code>。</p>
<h2 id="通过Object自定义processor">通过Object自定义processor</h2><p>下面，我们通过编写一个简单的<code>StringReplacer</code>，介绍了如何自定义自己的processor：</p>
<h3 id="只需要一步：在getProcessor方法中，使用JS_plain_Object">只需要一步：在getProcessor方法中，使用<code>JS plain Object</code></h3><p><code>getProcessors</code>方法返回的是处理器实例数组。如果其中的项是一个<code>JS plain Object</code>，构建主模块会自动让其具有默认的行为。</p>
<p>自定义Processor的Object中，我们必须包含<code>name</code>项，EDP在输出当前Build的过程时，会用到这个属性。我们可以根据自己的需求，选择复写<code>start</code>、<code>process</code>、<code>beforeAll</code>、<code>afterAll</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">exports.getProcessors = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        <span class="keyword">new</span> LessCompiler(&#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> CssCompressor(&#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 通过`JS plain Object`自定义processor</span></span><br><span class="line">        &#123;</span><br><span class="line">            files: [ <span class="string">'index.html'</span> ],</span><br><span class="line">            from: <span class="string">'oldvalue'</span>,</span><br><span class="line">            to: <span class="string">'newvalue'</span>,</span><br><span class="line">            name: <span class="string">'StringReplacer'</span>,</span><br><span class="line">            process: <span class="function"><span class="keyword">function</span> (<span class="params">file, processContext, callback</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.from &amp;&amp; <span class="keyword">this</span>.to) &#123;</span><br><span class="line">                    file.setData(</span><br><span class="line">                        file.data.replace(from, to)</span><br><span class="line">                    );</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                callback();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>至此，我们已经完成了<code>StringReplacer</code>的开发和使用。</p>
<h2 id="从AbstractProcessor继承自定义processor">从AbstractProcessor继承自定义processor</h2><p>和上面的章节一样，下面通过编写一个简单的<code>StringReplacer</code>，介绍了如何自定义自己的Processor：</p>
<h3 id="第一步：写一个类，并继承于AbstractProcessor">第一步：写一个类，并继承于AbstractProcessor</h3><p><code>配置文件</code>被EDP加载后，将通过<code>injectProcessor</code>方法往配置模块的<code>global</code>中注入<code>内置Processors</code>，其中包含了processor的抽象类<code>AbstractProcessor</code>。我们需要编写自己的Processor类，并通过原型继承的方式，从<code>AbstractProcessor</code>继承。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">defineStringReplacer</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">StringReplacer</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">        AbstractProcessor.call(<span class="keyword">this</span>, options);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    StringReplacer.prototype = <span class="keyword">new</span> AbstractProcessor();</span><br><span class="line">    StringReplacer.prototype.name = <span class="string">'StringReplacer'</span>;</span><br><span class="line">    <span class="keyword">return</span> StringReplacer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们需要为自己的Processor指定一个name，EDP在输出当前Build的过程时，会用到这个属性。</p>
<p>注意：由于EDP在加载完<code>配置模块</code>后，才会进行<code>内置Processors</code>注入，所以直接在配置模块的下编写Processor类并继承会失败，因为这时<code>AbstractProcessor</code>还没有被注入。所以Processor类应编写在一个function内，并在未来执行（见第三步）。</p>
<h3 id="第二步：编写process方法">第二步：编写process方法</h3><p>我们可以根据自己的需求，选择复写<code>start</code>、<code>process</code>、<code>beforeAll</code>、<code>afterAll</code>。在当前场景下，我们只需要编写<code>process</code>方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">defineStringReplacer</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">StringReplacer</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">        AbstractProcessor.call(<span class="keyword">this</span>, options);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    StringReplacer.prototype = <span class="keyword">new</span> AbstractProcessor();</span><br><span class="line">    StringReplacer.prototype.name = <span class="string">'StringReplacer'</span>;</span><br><span class="line">    StringReplacer.prototype.process = <span class="function"><span class="keyword">function</span> (<span class="params">file, processContext, callback</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.from &amp;&amp; <span class="keyword">this</span>.to) &#123;</span><br><span class="line">            file.setData(</span><br><span class="line">                file.data.replace(from, to)</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        callback();</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> StringReplacer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="第三步：使用自己的Processor">第三步：使用自己的Processor</h3><p>我们可以在<code>getProcessors</code>方法中，初始化自己的Processor类，并使用它。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">exports.getProcessors = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> StringReplacer = defineStringReplacer();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        <span class="keyword">new</span> LessCompiler(&#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> CssCompressor(&#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> StringReplacer(&#123;</span><br><span class="line">            files: [ <span class="string">'index.html'</span> ],</span><br><span class="line">            from: <span class="string">'oldvalue'</span>,</span><br><span class="line">            to: <span class="string">'newvalue'</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>至此，我们已经完成了<code>StringReplacer</code>的开发和使用。</p>

</article>

<nav class="article-pagination">
    
    <a href="/edp/doc/build/builtin-processor/" class="article-prev">前一篇: 内置 Processor</a>
    
    
    <a href="/edp/doc/build/cust-build/" class="article-next">后一篇: 通过配置进行自定义构建</a>
    
</nav>

<div class="ds-thread" data-thread-key="doc/build/cust-processor/" data-title="自定义 Processor" data-url="http://ecomfe.github.io/edp/doc/build/cust-processor/"></div>
<script>
var duoshuoQuery = {short_name:"edp"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';
    ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>

    
    </section>
</div>

<footer>
    <p class="cp">©2015 <a href="http://efe.baidu.com/" target="_blank">Baidu EFE</a> | Powered By <a href="http://hexo.io/">Hexo</a></p>
</footer>


</body>
</html>