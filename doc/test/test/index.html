<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <title>项目测试 | EDP</title>
    <link rel="stylesheet" href="/edp/css/page.css" type="text/css">
    <link rel="stylesheet" href="/edp/css/font-awesome.css" type="text/css">
    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?9773c6955c8a4722f2938db42b6d6c04";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
</head>
<body>
<header id="header">
    <a class='logo' href="/edp/">
        <img src="/edp/css/images/logo.png" width="120" alt="logo">
    </a>

    <nav class="menu">
        <a href="/edp/doc/initialization/install/"><i class="fa fa-book"></i> Docs</a>
        <a href="https://github.com/ecomfe/edp" target="_blank"><i class="fa fa-github"></i> GitHub</a>
    </nav>
</header>

<div class="wrap">
    <aside id="sidebar">
<div class="tree">
    <h1>Category</h1>
    <ul class="category">
        <li><b class="cat-title">安装与使用</b>
            <ul>
                <li><a href="/edp/doc/initialization/install/">安装</a>
                    <ul>
                        <li><a href="/edp/doc/initialization/install/#npm_install">npm install</a></li>
                        <li><a href="/edp/doc/initialization/install/#使用cnpm安装">使用cnpm安装</a></li>
                        <li><a href="/edp/doc/initialization/install/#使用内网npm镜像安装">使用内网npm镜像安装</a></li>
                    </ul>
                </li>
                <li><a href="/edp/doc/initialization/use-cli/">通过命令行使用</a></li>
                <li><a href="/edp/doc/initialization/use-web/">通过web使用</a></li>
                <li><a href="/edp/doc/initialization/update/">升级</a></li>
            </ul>
        </li>
        <li><b class="cat-title">包管理</b>
            <ul>
                <li><a href="/edp/doc/package-management/reasonof-pack-mngm/">为什么要进行包管理</a></li>
                <li><a href="/edp/doc/package-management/find-curr-pack/">查找当前存在的包</a></li>
                <li><a href="/edp/doc/package-management/instl-and-use/">导入并使用包</a>
                    <ul>
                        <li><a href="/edp/doc/package-management/instl-and-use/#导入包的最新版">导入包的最新版</a></li>
                        <li><a href="/edp/doc/package-management/instl-and-use/#导入指定版本的包">导入指定版本的包</a></li>
                    </ul>
                </li>
                <li><a href="/edp/doc/package-management/update-pack/">升级已导入的包</a>
                    <ul>
                        <li><a href="/edp/doc/package-management/update-pack/#升级指定包">升级指定包</a></li>
                        <li><a href="/edp/doc/package-management/update-pack/#升级所有包">升级所有包</a></li>
                    </ul>
                </li>
            </ul>
        </li>
        <li><b class="cat-title">项目管理</b>
            <ul>
                <li><a href="/edp/doc/project-management/init-proj/">初始化项目</a></li>
                <li><a href="/edp/doc/project-management/advantage/">使用edp项目的好处</a></li>
            </ul>
        </li>
        <li><b class="cat-title">项目构建</b>
            <ul>
                <li><a href="/edp/doc/build/build/">构建一个项目</a>
                    <ul>
                        <li><a href="/edp/doc/build/build/#指定输出目录">指定输出目录</a></li>
                        <li><a href="/edp/doc/build/build/#强制覆盖">强制覆盖</a></li>
                        <li><a href="/edp/doc/build/build/#指定构建配置文件">指定构建配置文件</a></li>
                    </ul>
                </li>
                <li><a href="/edp/doc/build/build-proc/">构建过程</a></li>
                <li><a href="/edp/doc/build/builtin-processor/">内置 Processor</a>
                    <ul>
                        <li><a href="/edp/doc/build/builtin-processor/#公共属性">公共属性</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#LessCompiler">LessCompiler</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#StylusCompiler">StylusCompiler</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#CssCompressor">CssCompressor</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#JsCompressor">JsCompressor</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#ModuleCompiler">ModuleCompiler</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#PathMapper">PathMapper</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#TplMerge">TplMerge</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#AddCopyright">AddCopyright</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#VariableSubstitution">VariableSubstitution</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#MD5Renamer">MD5Renamer</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#OutputCleaner">OutputCleaner</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#BabelProcessor">BabelProcessor</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#BcsUploader">BcsUploader</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#CssSpriter">CssSpriter</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#HtmlMinifier">HtmlMinifier</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#Html2JsCompiler">Html2JsCompiler</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#ReplaceDebug">ReplaceDebug</a></li>
                        <li><a href="/edp/doc/build/builtin-processor/#StringReplace">StringReplace</a></li>

                    </ul>
                </li>
                <li><a href="/edp/doc/build/cust-processor/">自定义 Processor</a>
                    <ul>
                        <li><a href="/edp/doc/build/cust-processor/#Processor的运行过程">Processor的运行过程</a></li>
                        <li><a href="/edp/doc/build/cust-processor/#通过Object自定义processor">通过Object自定义processor</a></li>
                        <li><a href="/edp/doc/build/cust-processor/#从AbstractProcessor继承自定义processor">从AbstractProcessor继承自定义processor</a></li>
                    </ul>
                </li>
                <li><a href="/edp/doc/build/cust-build/">通过配置进行自定义构建</a>
                    <ul>
                        <li><a href="/edp/doc/build/cust-build/#input">input</a></li>
                        <li><a href="/edp/doc/build/cust-build/#output">output</a></li>
                        <li><a href="/edp/doc/build/cust-build/#exclude">exclude</a></li>
                        <li><a href="/edp/doc/build/cust-build/#fileEncodings">fileEncodings</a></li>
                        <li><a href="/edp/doc/build/cust-build/#getProcessors">getProcessors</a></li>
                        <li><a href="/edp/doc/build/cust-build/#injectProcessor">injectProcessor</a></li>
                    </ul>
                </li>
            </ul>
        </li>
        <li><b class="cat-title">前端代码静态检测</b>
            <ul>
                <li><a href="/edp/doc/lint/code-check/">代码检测</a></li>
                <li><a href="/edp/doc/lint/js-check/">Javascript代码检测</a>
                    <ul>
                        <li><a href="/edp/doc/lint/js-check/#自定义配置">自定义jshint配置</a></li>
                        <li><a href="/edp/doc/lint/js-check/#排除检测文件">排除检测文件</a></li>
                    </ul>
                </li>
                <li><a href="/edp/doc/lint/css-check/">CSS代码检测</a>
                    <ul>
                        <li><a href="/edp/doc/lint/css-check/#自定义配置">自定义csslint配置</a></li>
                        <li><a href="/edp/doc/lint/css-check/#排除检测文件">排除检测文件</a></li>
                    </ul>
                </li>
                <li><a href="/edp/doc/lint/html-check/">HTML代码检测</a>
                    <ul>
                        <li><a href="/edp/doc/lint/html-check/#排除检测文件">排除检测文件</a></li>
                    </ul>
                </li>
            </ul>
        </li>
        <li><b class="cat-title">使用WebServer进行调试</b>
            <ul>
                <li><a href="/edp/doc/webserver/start-server/">启动WebServer</a>
                    <ul>
                        <li><a href="/edp/doc/webserver/start-server/#指定监听端口">指定监听端口</a></li>
                        <li><a href="/edp/doc/webserver/start-server/#指定WebServer配置文件">指定WebServer配置文件</a></li>
                    </ul>
                </li>
                <li><a href="/edp/doc/webserver/conf-server/">配置WebServer</a>
                    <ul>
                        <li><a href="/edp/doc/webserver/conf-server/#port">port</a></li>
                        <li><a href="/edp/doc/webserver/conf-server/#directoryIndexes">directoryIndexes</a></li>
                        <li><a href="/edp/doc/webserver/conf-server/#documentRoot">documentRoot</a></li>
                        <li><a href="/edp/doc/webserver/conf-server/#injectResource">injectResource</a></li>
                        <li><a href="/edp/doc/webserver/conf-server/#getLocations">getLocations</a></li>
                    </ul>
                </li>
                <li><a href="/edp/doc/webserver/resource-func/">资源处理函数</a></li>
                <li><a href="/edp/doc/webserver/inner-resour-func/">内置资源处理函数</a>
                    <ul>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#file">file</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#content">content</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#header">header</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#json">json</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#jsonp">jsonp</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#dumpRequest">dumpRequest</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#redirect">redirect</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#less">less</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#autoless">autoless</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#stylus">stylus</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#autostylus">autostylus</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#autocss">autocss</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#coffee">coffee</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#autocoffee">autocoffee</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#php">php</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#proxy">proxy</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#proxyNoneExists">proxyNoneExists</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#html2js">html2js</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#livereload">livereload</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#listDirectory">listDirectory</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#addRequestHeader">addRequestHeader</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#write">write</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#home">home</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#delay">delay</a></li>
                        <li><a href="/edp/doc/webserver/inner-resour-func/#empty">empty</a></li>
                    </ul>
                </li>
                <li><a href="/edp/doc/webserver/cust-resour-func/">自定义资源处理函数</a></li>
            </ul>
        </li>
        <li><b class="cat-title">项目测试</b>
            <ul>
                <li><a href="/edp/doc/test/test/#初始化配置">初始化配置</a>
                    <ul>
                        <li><a href="/edp/doc/test/test/#注意事项">注意事项</a></li>
                    </ul>
                </li>
                <li><a href="/edp/doc/test/test/#开始测试">开始测试</a>
                    <ul>
                        <li><a href="/edp/doc/test/test/#ES6_代码的测试">ES6 代码的测试</a></li>
                        <li><a href="/edp/doc/test/test/#注意事项-1">注意事项</a></li>
                    </ul>
                </li>
            </ul>
        </li>
        <li><b class="cat-title">扩展自己的EDP命令</b>
            <ul>
                <li><a href="/edp/doc/command-extension/builtin-comd/">Builtin Commands</a></li>
                <li><a href="/edp/doc/command-extension/comd-resol/">Command Resolve</a>
                    <ul>
                        <li><a href="/edp/doc/command-extension/comd-resol/#Default Command">Default Command</a></li>
                        <li><a href="/edp/doc/command-extension/comd-resol/#Sub Command">Sub Command</a></li>
                        <li><a href="/edp/doc/command-extension/comd-resol/#Arguments and Options">Arguments and Options</a></li>
                    </ul>
                </li>
                <li><a href="/edp/doc/command-extension/user-comd/">User Commands</a></li>
                <li><a href="/edp/doc/command-extension/comd-help/">Command Help</a></li>
            </ul>
        </li>
        <li><b class="cat-title">诊断工具</b>
            <ul>
                <li><a href="/edp/doc/doctor/doctor/">Doctor</a></li>
            </ul>
        </li>
    </ul>
</div>
</aside>
<script src="//libs.baidu.com/jquery/1.9.1/jquery.min.js"></script>
<script>
$(function () {
    var pathname = location.pathname;
    var hash = location.hash;
    var showClass = 'open';
    var currentClass = 'current';
    var currentLinks;

    var getTargetTop = function (a) {
        var top = 0;
        if (a.hash) {
            var target = $(a.hash);
            top = target[0] ? target.offset().top : 0;
        }

        return top;
    }

    $('.category')
        .on('click', 'a', function (e) {
            if (this.pathname === pathname) {
                e.preventDefault();

                $(document.body).animate({scrollTop: getTargetTop(this)});
                $(e.delegateTarget).find('.' + currentClass).removeClass(currentClass);
                $(this).addClass(currentClass);
            }
        })
        .on('click', '.cat-title', function (e) {
            $(this).next('ul')
                .toggle('fast')
            .parent('li')
                .toggleClass(showClass)
                .siblings().removeClass(showClass)
                .find('>ul').hide('fast');
        })
        .find('>li').each(function (i, li) {
            var links = $(li).find('a')
                .filter(function (i, a) {
                    if (a.pathname === pathname) {
                        $(li).addClass(showClass).find('>ul').show('fast');
                        if (!hash && !a.hash || hash && hash === a.hash) {
                            $(a).addClass(currentClass);
                        }
                        return true;
                    }
                })
                .each(function (i, a) {
                    $(a).data('top', getTargetTop(a));
                });

            if (links.length) {
                currentLinks = links;
            }
        });

    var timer;
    var scroll = function () {
        if (!currentLinks) {
            return;
        }

        var top = $(document).scrollTop();
        var viewHeight = document.documentElement.clientHeight;
        var span = 50;

        var match = currentLinks.filter(function (i, a) {
            var targetTop = $(a).data('top');
            return targetTop === 0 && top < span
                || targetTop >= top + span && targetTop - span <= top + viewHeight;
        });

        if (match.length) {
            currentLinks.removeClass(currentClass);
            $(match[0]).addClass(currentClass);
            // location.hash = match[0].hash;
        }
    };

    $(document).scroll(function (e) {
        clearTimeout(timer);
        timer = setTimeout(scroll, 100);
    });
});
/*

    $(function() {
        $(".category a").on("click", function() {
            var $this = $(this);
            var $li = $this.parents("li:eq(0)");
            var $ul = $li.children("ul:eq(0)");

            if($($ul)[0].className){
                $ul.removeClass();
                $this.removeClass('open');
            }
            else{
                $ul.addClass("show");
                $this.addClass('open');
            }
            var str = "";
            $(".category.show").each(function(){
                str += $("ul").index($(this)[0]) + " ";
            });
            localStorage.setItem("show_index", str);
        });

        var str = localStorage.getItem("show_index");
        if (!str) {
            return;
        }
        str = str.substring(0, str.length - 1);
        var arr = str.split(" ");
        for(var i = 0; i < arr.length; i++) {
            $("ul:eq(" + arr[i] + ")").addClass("show");
        }

        $(".category.show").siblings("a").addClass('open');

    });
*/
//    var aa = document.getElementsByTagName('a');
////    alert(lis.length);
////    e.stopPropagation();
//
//    for(var i = 0; i < aa.length; i++){
//        if(document.all){
//            aa[i].attachEvent('onclick', toggleList);
//        }
//        else{
//            aa[i].addEventListener('click', toggleList, false);
//        }
//    }
//    function toggleList(e){
//        var e = e || window.event;
//        var childList = e.srcElement.parentElement.getElementsByTagName('ul');
////        alert(childList.length);
//        if(childList.length > 0) {
////            alert(childList[0].className);
//            if(childList[0].className) {
//                childList[0].removeAttribute('class');
//            }
//            else {
//                childList[0].setAttribute('class', 'show');
//            }
//        }
//
////        alert(typeof(e.srcElement.parentElement) );
//    }
</script>

    <section id="main">
        <article>
    <h1 class="article-title">项目测试</h1>

    <p>EDP 默认支持浏览器端 <a href="https://github.com/amdjs/amdjs-api/wiki/AMD" target="_blank" rel="external">AMD</a> 项目的 BDD 测试，支持 <a href="http://jasmine.github.io/" target="_blank" rel="external">Jasmine</a> 的语法，对于代码覆盖率使用 <a href="https://github.com/gotwarlost/istanbul" target="_blank" rel="external">istanbul</a>，配合 <a href="/edp/doc/webserver/start-server/">WebServer</a>，能大大降低项目的测试门槛。</p>
<h2 id="初始化配置">初始化配置</h2><blockquote>
<p>$ edp test init</p>
</blockquote>
<p>EDP 将在 <strong>test</strong> 目录下创建 <strong>config.js</strong> 文件，默认配置的模板内容如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Test configuration for edp-test</span></span><br><span class="line"><span class="comment">// Generated on %DATE%</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// base path, that will be used to resolve files and exclude</span></span><br><span class="line">    basePath: <span class="string">'../'</span>,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// frameworks to use</span></span><br><span class="line">    frameworks: [<span class="string">'jasmine'</span>, <span class="string">'esl'</span>],</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// list of files / patterns to load in the browser</span></span><br><span class="line">    files: [</span><br><span class="line">        <span class="string">'test/**/*Spec.js'</span></span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// optionally, configure the reporter</span></span><br><span class="line">    coverageReporter: &#123;</span><br><span class="line">        <span class="comment">// text-summary | text | html | json | teamcity | cobertura | lcov</span></span><br><span class="line">        <span class="comment">// lcovonly | none | teamcity</span></span><br><span class="line">        type : <span class="string">'text|html'</span>,</span><br><span class="line">        dir : <span class="string">'test/coverage/'</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// web server port</span></span><br><span class="line">    port: <span class="number">8120</span>,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// enable / disable watching file and executing tests whenever any file changes</span></span><br><span class="line">    watch: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start these browsers, currently available:</span></span><br><span class="line">    <span class="comment">// - Chrome</span></span><br><span class="line">    <span class="comment">// - Firefox</span></span><br><span class="line">    <span class="comment">// - Opera</span></span><br><span class="line">    <span class="comment">// - Safari</span></span><br><span class="line">    <span class="comment">// - PhantomJS</span></span><br><span class="line">    <span class="comment">// - IE (only Windows)</span></span><br><span class="line">    browsers: [</span><br><span class="line">        <span class="comment">// 'Chrome',</span></span><br><span class="line">        <span class="comment">// 'Firefox',</span></span><br><span class="line">        <span class="comment">// 'Safari',</span></span><br><span class="line">        <span class="string">'PhantomJS'</span></span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Continuous Integration mode</span></span><br><span class="line">    <span class="comment">// if true, it capture browsers, run tests and exit</span></span><br><span class="line">    singleRun: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Custom HTML templates</span></span><br><span class="line">    <span class="comment">// context | debug | runner</span></span><br><span class="line">    templates: &#123;</span><br><span class="line">        <span class="comment">// context: 'context.html'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="注意事项">注意事项</h3><ul>
<li>默认匹配到的 Spec 文件名为 test 目录下的所有文件名以 <strong>Spec.js</strong> 结尾的文件，如果你的 Spec 命名模式不符可修改 <code>files</code> 项的配置。</li>
<li>默认将使用 <a href="https://github.com/Medium/phantomjs" target="_blank" rel="external">PhantomJS</a> 来运行测试，需要确认已经安装。</li>
<li>默认使用的 <strong>Jasmine</strong> 版本为 <strong>1.3.1</strong>，要使用 <strong>2.0.0</strong> 需要配置 <code>frameworks</code> 中的 <code>jasmine</code> 为 <code>jasmine2</code>。</li>
<li>默认使用的 <strong>AMD</strong> 实现为 <a href="https://github.com/ecomfe/esl" target="_blank" rel="external">ESL</a>。</li>
<li>如果项目使用了旧版的 <code>edp-test</code>，或已经存在 <strong>test/config.js</strong>，会提示是否覆盖，除非使用 <code>--force</code> 参数强制覆盖。</li>
</ul>
<h2 id="开始测试">开始测试</h2><p>编写完 Spec 之后，确认 <strong>test/config.js</strong> 配置无误，就可以通过以下命令开始测试了：</p>
<blockquote>
<p>$ edp test start<br>$ edp test start<br>$ edp test start [—singleRun]<br>$ edp test start [—singleRun true]<br>$ edp test start [—singleRun false]<br>$ edp test start [—watch]<br>$ edp test start [—watch true]<br>$ edp test start [—watch false]</p>
</blockquote>
<p><a href="https://github.com/ecomfe/emc" target="_blank" rel="external">EMC</a> 项目的测试输入如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">edp INFO Build runner...&#10;edp INFO Runner build.&#10;edp INFO Test port 8120...&#10;edp INFO Port 8120 available&#10;&#10;edp INFO EDP WebServer start, http://192.168.199.187:8120&#10;edp INFO root = [/Users/chris/sites/ecomfe/emc], listen = [8120]&#10;edp INFO Chrome 45.0.2454 (Mac OS X 10.10.2) - 6ca0t8 connected.&#10;&#10;edp INFO PhantomJS 1.9.8 (Mac OS X) - jik9h6 connected.&#10;PhantomJS 1.9.8 (Mac OS X)&#65306;Executed 100 % (128 / 128)&#10;PhantomJS 1.9.8 (Mac OS X):&#10;    edp test [SUCCESS] TOTAL: 0 SKIP, 128 SUCCESS&#10;&#10;----------|-----------|-----------|-----------|-----------|&#10;File      |   % Stmts |% Branches |   % Funcs |   % Lines |&#10;----------|-----------|-----------|-----------|-----------|&#10;----------|-----------|-----------|-----------|-----------|&#10;All files |       100 |       100 |       100 |       100 |&#10;----------|-----------|-----------|-----------|-----------|&#10;Chrome 45.0.2454 (Mac OS X 10.10.2)&#65306;Executed 100 % (128 / 128)&#10;Chrome 45.0.2454 (Mac OS X 10.10.2):&#10;    edp test [SUCCESS] TOTAL: 0 SKIP, 128 SUCCESS&#10;&#10;----------|-----------|-----------|-----------|-----------|&#10;File      |   % Stmts |% Branches |   % Funcs |   % Lines |&#10;----------|-----------|-----------|-----------|-----------|&#10;----------|-----------|-----------|-----------|-----------|&#10;All files |       100 |       100 |       100 |       100 |&#10;----------|-----------|-----------|-----------|-----------|</span><br></pre></td></tr></table></figure>
<p>上面的输出中省去了二维码的显示，可以通过配置文件中的 <code>qrcode</code> 来打开或关闭。</p>
<h3 id="ES6_代码的测试">ES6 代码的测试</h3><p>由于目前（截止至 2015-9-23）对 ES6 的支持主要依赖 <a href="http://babeljs.io/" target="_blank" rel="external">babel</a> 的预处理，所以对于此类项目代码的测试支持，主要配置在 <code>WebServer</code> 的配置文件 <strong>edp-webserver-config.js</strong>。典型的 ES6 项目关键配置如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> BABEL_OPTIONS = &#123;</span><br><span class="line">  loose: <span class="string">'all'</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 指定生成 AMD 的模块，edp-test 不支持非 AMD 模块的测试</span></span><br><span class="line">  modules: <span class="string">'amd'</span>,</span><br><span class="line">  compact: <span class="literal">false</span>,</span><br><span class="line">  ast: <span class="literal">false</span>,</span><br><span class="line">  blacklist: [<span class="string">'strict'</span>],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">exports.getLocations = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 标识为需预处理的源码，edp-test 会对测试结果使用 sourcemap 映射源码</span></span><br><span class="line">            key: <span class="string">'source'</span>,</span><br><span class="line">            location: <span class="regexp">/^\/src\/.+\.js(\?.+)?/</span>,</span><br><span class="line">            handler: [</span><br><span class="line">                file(),</span><br><span class="line"></span><br><span class="line">                babel(BABEL_OPTIONS)</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 这里只匹配 Spec 文件，不需要配 key: 'source'</span></span><br><span class="line">            <span class="comment">// 如果 Spec 不是使用 ES6 编写，可以省略本段配置</span></span><br><span class="line">            location: <span class="regexp">/^\/test\/.+\/*Spec\.js(\?.+)?/i</span>,</span><br><span class="line">            handler: [</span><br><span class="line">                file(),</span><br><span class="line">                babel(BABEL_OPTIONS)</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            location: <span class="regexp">/^.*$/</span>,</span><br><span class="line">            handler: [</span><br><span class="line">                file()</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="注意事项-1">注意事项</h3><ul>
<li>babel 的配置项 <code>modules</code> 必须设为 ‘amd’，并且生成 <strong>sourcemap</strong>（WebServer 的 babel handler 已自动处理）。</li>
<li><code>getLocations</code> 数组的项中，使用 <code>key: &#39;source&#39;</code> 标识当前路径为需要预处理的源码，<code>edp-test</code> 将根据生成的 sourcemap 来映射编译后的代码与源码的关系，主要体现在代码覆盖率的展示。</li>
<li>仅当 Spec 也使用 ES6 编写需要 babel 编译时才需要第二项配置，并且该项配置不需要指定 <code>key: &#39;source&#39;</code>，否则 Spec 代码也被 istanbul 插入统计代码，导致 test case 不通过时调试代码行无法对应上源码的问题。</li>
</ul>

</article>

<nav class="article-pagination">
    
    
    <a href="/edp/doc/lint/html-check/" class="article-next">后一篇: HTML 代码检查</a>
    
</nav>

<div class="ds-thread" data-thread-key="doc/test/test/" data-title="项目测试" data-url="http://ecomfe.github.io/edp/doc/test/test/"></div>
<script>
var duoshuoQuery = {short_name:"edp"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';
    ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>

    
    </section>
</div>

<footer>
    <p class="cp">©2015 <a href="http://efe.baidu.com/" target="_blank">Baidu EFE</a> | Powered By <a href="http://hexo.io/">Hexo</a></p>
</footer>


</body>
</html>